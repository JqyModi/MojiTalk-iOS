# MOJi会话 (MOJiKaiwa-iOS) 项目需求文档 (PRD)

## 1. 项目概述
### 1.1 项目简介
MOJi会话是一款专为日语学习者打造的沉浸式口语练习应用。通过集成先进的 AI 技术与 Live2D 交互技术，为用户提供一个随时随地的虚拟日语外教环境。

### 1.2 核心价值
- **沉浸式练习**：通过 AI 角色模拟真实对话场景。
- **智能辅助**：集成 AI 翻、润、析功能，降低表达门槛。
- **趣味互动**：通过 Live2D 角色提升学习趣味性。
- **结构化内容**：提供口语册等体系化课程，满足不同程度学习需求。

---

## 2. 技术架构
### 2.1 架构设计
项目采用 **高度模块化 (Modularization)** 的架构设计，通过私有 CocoaPods 仓库管理核心组件：
- **解耦核心库**：将账号 (`MOJiAccount`)、底层基类 (`MOJiBase`)、数据库 (`MOJiDB`)、支付 (`MOJiFK`)、音频 (`MOJiAudioPlayer`) 等逻辑封装为独立 Pod。
- **业务模块化**：主工程 (`MOJiKaiwa`) 内部按业务划分为 `Talk` (AI对话)、`Book` (口语册)、`Me` (个人中心) 等模块。
- **设计模式**：核心模块内部遵循经典的 **MVC (Model-View-Controller)** 模式。

### 2.2 核心组件关系
- **通信层**：采用 SSE (Server-Sent Events) 实现在 AI 对话中的流式响应。
- **表现层**：集成 Live2D Native SDK，实现虚拟角色的动态展示与口型同步。
- **数据层**：利用 Parse 作为后端服务，结合本地 FMDB 加密数据库备份。

---

## 3. 技术栈
### 3.1 基础开发
| 类别 | 详情 |
|------|------|
| **编程语言** | Swift (主导) / Objective-C |
| **最低支持系统** | iOS 13.0 |
| **包管理工具** | CocoaPods |
| **构建工具** | Xcode, Fastlane |

### 3.2 核心第三方库
- **UI/布局**：`Masonry`, `JXSegmentedView`, `MJRefresh`, `SVProgressHUD`.
- **网络/数据**：`Parse`, `YYModel`, `HandyJSON`, `SwiftyJSON`, `SDWebImage`.
- **多媒体**：`Live2D SDK`, `AliPlayerSDK`, `ZFPlayer`, `AVFoundation`.
- **工具/分析**：`Firebase (Analytics/Crashlytics)`, `UICKeyChainStore`, `DateTools`.

---

## 4. 业务功能汇总
### 4.1 AI 对话模块 (Core)
- **多模态输入**：支持文字输入及语音录制（自动转文字）。
- **流式对话**：AI 实时生成响应，支持断点续接。
- **AI 增强工具**：
    - **翻译**：支持中日双向即时翻译。
    - **润色**：AI 自动纠正语法，优化表达。
    - **语法分析**：对句子结构进行深度解析（会员功能）。
- **角色系统**：支持切换不同声优、性格的 Live2D 形象。

### 4.2 口语册模块 (Book)
- **体系化课程**：提供基于不同场景（职场、旅游、日常）的场景化对话内容目录。
- **界面结构**：
    - **场景选择器 (`MOJiAISceneView`)**：横向滑动切换大类场景（如：餐厅、机场、购物）。
    - **折叠式目录**：二级分类结构，支持展开/收起具体对话主题。
- **学习进度**：进度可视化标识，支持状态记忆（记住用户上次展开的目录）。
- **权限联动**：游客可浏览目录，进入具体对话需登录。

### 4.3 会员与支付系统
- **权限管理**：区分游客、登录用户、会员用户，实现功能分级（如每日对话限额、高级分析权限、特权场景访问）。
- **支付集成**：支持 Apple 内购 (IAP)，集成微信/QQ 登录与多平台分享功能 (`MOJiShare`)。

### 4.4 个人中心 (Me)
- **学习统计**展示累计练习量；包含主题切换 (Dark Mode)、多语言设置 (中/英/韩)、账号管理及开发者调试工具出口。

---

## 5. 项目亮点与挑战
- **Live2D 同步**：利用 `OpenL2DTalkView` 实现了 AI 语音播放与 Live2D 模型表情、口型、动作的精确同步。
- **配置驱动**：场景对话与口语册内容多由 `MDConfigHelper` 动态配置驱动，具备高度灵活性。
- **全球化支持**：多语言包 (`.xcstrings`) 完整适配简繁中、英、韩，UI 布局支持多语言自适应。
- **CI/CD 自动化**：通过 Fastlane 和 GitLab CI 实现自动化发包，并针对 App Store 审核有严格的关键词防护（wxpay/alipay 等敏感词自动检测）。

---

## 6. 环境要求
- **Xcode 版本**：建议使用最新 Stable 版本（需支持 iOS 16+ 编译环境）。
- **Ruby 环境**：项目中配置有 `Gemfile`，需安装 Bundler 管理 Fastlane 等工具。
- **开发工具**：推荐使用 `Lookin` 进行 UI 调试，`DoraemonKit` 进行端内调试。
